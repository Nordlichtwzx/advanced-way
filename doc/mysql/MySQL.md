# MySQL

## 1. 索引

### 1.1 索引概述

​		MySQL官方对索引的定义为：索引（index）是帮助MySQL高效获取数据的数据结构（有序）。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引

![](images\索引.png)

### 1.2 索引优劣

**优势**

1. 类似于书籍的目录索引，提高数据检索效率的同时，降低数据库的IO成本
2. 通过索引对列数据进行排序，降低数据排序的成本，降低CPU的消耗

**劣势**

1. 索引会占据额外的磁盘空间
2. 索引会影响更新表的速度，因为在更新表数据的同时也需要更新索引。

### 1.3 索引结构

索引是在MySQL的存储引擎层中实现的，而不是在服务器层，所以每种存储引擎支持的索引都不完全一样，也不是所有的存储引擎都支持所有的索引类型

![](images\引擎索引.png)

### 1.4 BTREE结构

BTree又叫多路平衡搜索树，一颗m叉的BTree特性如下

* 树中每个节点最多包含m个孩子
* 除根节点与叶子结点外，每个节点至少是有[ceil(m/2)]（向上取整）个孩子
* 若根节点不是叶子节点，则至少有两个还在孩子
* 所有的叶子结点都在同一层
* 每个非叶子节点由n个key与n+1个指针组成，其中[ceil(m/2)-1]<=n<=m-1

### 1.5 B+树

* n叉B+树最多有n个key
* B+ 树的叶子结点保存key所在节点的信息，按照key大小排列
* 所有的非叶子结点都可以看作是key的索引部分

#### MySQL中的B+树

MySQL的B+树对经典的B+树进行了优化，在原有B+树的基础上，**增加了一个指向相邻叶子结点的链表指针**，就形成了带有顺序指正的B+树，这样可以提高区间访问的性能。

![](images\mysqlb+.png)

### 1.6 索引分类

1. 单值索引：即一个索引只包含单个列，一个表可以有多个单列索引
2. 唯一索引：索引列的值必须唯一，但允许有空值
3. 符合索引，即一个索引包含多个列

### 1.7 索引设计原则

* 对查询频次高，且数据量大的表建立索引
* 索引字段的选择，最佳候选列应当从where子句的条件中提取，如果where子句中的组合较多，那么应该挑选最常用、过滤效果最好的列的组合
* 使用唯一索引，区分度越高，使用索引的效率越高
* 索引不是多多益善，索引越多需要额外维护的成本就越高。**索引过多**会引入相当高的维护代价，降低DML操作的效率。另外索引过多的话，MySQL也会犯选择困难症，提高了选择的代价
* 使用段索引，因为索引也会占据额外的磁盘空间，段所有可以有效提升MySQL访问索引的I/O效率
* 利用最左前缀，组合索引。